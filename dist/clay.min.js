/*! clay 2014-06-04 */
(function(){var a,b,c,d=function(a,b){return function(){return a.apply(b,arguments)}},e=[].slice;b=function(){function b(a,b){this.bindOnResize=d(this.bindOnResize,this),this.pollDirtyness=d(this.pollDirtyness,this),this.layout=d(this.layout,this),this.append=d(this.append,this),this.prepend=d(this.prepend,this),this.addItems=d(this.addItems,this),this.setupGrid=d(this.setupGrid,this),this.measure=d(this.measure,this),this._merge_opts(this.defaults,b),this.container=document.querySelector(a),this.itemSelector=this.defaults.itemSelector,this.minWidth=this.defaults.minWidth,this.padding=this.defaults.padding,this.gutter=this.defaults.gutter,this.ensureCSS(),this.measure(),this.setupGrid(),this.addItems(),this.layout(),this.pollDirtyness(),this.bindOnResize()}return b.prototype.defaults={itemSelector:".item",minWidth:200,padding:10,gutter:20},b.prototype.measure=function(){var a,b;return b=this.container.clientWidth,this.colCnt=Math.floor(b/this.minWidth),this.padding&&(b-=this.padding*(this.colCnt-1)),this.gutter&&(b-=2*this.gutter),a=(b-this.colCnt*this.minWidth)/this.colCnt,this.itemWidth=a+this.minWidth},b.prototype.setupGrid=function(){var b,c,d,e,f;for(this.columns=[],f=[],b=d=0,e=this.colCnt-1;e>=0?e>=d:d>=e;b=e>=0?++d:--d)console.log("adding new column"),c=this.itemWidth*b+this.gutter,c+=this.padding*b,f.push(this.columns.push(new a(this,this.itemWidth,c)));return f},b.prototype.ensureCSS=function(){var a,b,c,d,e;for(this.container.style.position="relative",b=this.container.querySelectorAll(this.itemSelector),e=[],c=0,d=b.length;d>c;c++)a=b[c],e.push(a.style.position="absolute");return e},b.prototype.addItems=function(){var a,b,c,d,e;for(b=document.querySelectorAll(this.itemSelector),e=[],c=0,d=b.length;d>c;c++)a=b[c],e.push(this.append(a));return e},b.prototype.prepend=function(a){var b;return this.container.contains(a)||(b=this.container.firstChild,this.container.insertBefore(a,b)),this.columns[0].items.unshift(a),this.measure(),this.setupGrid(),this.addItems(),this.layout()},b.prototype.append=function(a){var b,c,d,e,f,g;for(c=!this.container.contains(a),c&&this.container.appendChild(a),g=this.columns,e=0,f=g.length;f>e;e++)b=g[e],(!d||b.height<d.height)&&(d=b);return console.log("append item",a),d.append(a),c?d.items[d.items.length-1].layout():void 0},b.prototype.layout=function(){var a,b,c,d,e;for(console.log("grid layout issued"),d=this.columns,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.layout());return e},b.prototype.pollDirtyness=function(){return setInterval(function(a){return function(){var b,c,d,e,f,g,h,i,j;for(h=a.columns,j=[],d=0,f=h.length;f>d;d++){for(b=h[d],i=b.items,e=0,g=i.length;g>e;e++)c=i[e],c.dirtyCheck();b.dirty?(console.log("found column dirty",b),j.push(b.reLayout())):j.push(void 0)}return j}}(this),50)},b.prototype.bindOnResize=function(){var a;return a=this._debounce(function(a){return function(){return a.measure(),a.setupGrid(),a.addItems(),a.layout()}}(this)),window.addEventListener("resize",function(){return a()})},b.prototype._merge_opts=function(a,b){var c,d;d=[];for(c in b)d.push(a[c]=b[c]);return d},b.prototype._debounce=function(a,b,c){var d;return d=null,function(){var f,g,h;return f=1<=arguments.length?e.call(arguments,0):[],h=this,g=function(){return c||a.apply(h,f),d=null},d?clearTimeout(d):c&&a.apply(h,f),d=setTimeout(g,b||100)}},b}(),a=function(){function a(a,b,c){this.grid=a,this.width=b,this.left=c,this.layout=d(this.layout,this),this.reLayout=d(this.reLayout,this),this.append=d(this.append,this),this.items=[],this.height=0,this.dirty=!1}return a.prototype.append=function(a){var b;return b=this.height+this.grid.padding*this.items.length,this.items.push(new c(this,a,b)),this.height+=parseInt(a.clientHeight)},a.prototype.reLayout=function(){var a,b,c,d,e,f;for(console.log("column relayout issued"),this.height=0,f=this.items,a=d=0,e=f.length;e>d;a=++d)b=f[a],c=this.height+this.grid.padding*a,console.log("offset y",c),b.top=c,this.height+=parseInt(b.item.clientHeight);return this.layout(),this.dirty=!1},a.prototype.layout=function(){var a,b,c,d,e;for(d=this.items,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.layout());return e},a}(),c=function(){function a(a,b,c){this.column=a,this.item=b,this.top=c,this.layout=d(this.layout,this),this.dirtyCheck=d(this.dirtyCheck,this),this.item.style.width=""+this.column.width+"px",console.log("creating item with height:"+this.item.clientHeight,this.item),this.height=parseInt(this.item.clientHeight),this.dirty=!1}return a.prototype.dirtyCheck=function(){var a;return a=parseInt(this.item.clientHeight),this.height!==a?(console.log("found item dirty",this.item),this.dirty=!0,this.height=a,this.column.dirty=!0):void 0},a.prototype.layout=function(){var a,b;return a=this.column.left,b=this.top,this._setTransform("translate("+a+"px,"+b+"px)"),this.dirty=!1},a.prototype._setTransform=function(a){return this.item.style.webkitTransform=this.item.style.MozTransform=a},a}(),window.Clay=b}).call(this);